{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "description": "Heatmap of arrivals by country and year (1991-2024)",
  "title": "Arrivals heatmap (1991-2024)",
  "width": 700,
  "height": 420,
  "data": { "url": "data/Arrivals Time Series.csv" },
  "transform": [
    { "calculate": "datum['']", "as": "Country" },
    { "fold": [
      "1991","1992","1993","1994","1995","1996","1997","1998","1999",
      "2000","2001","2002","2003","2004","2005","2006","2007","2008",
      "2009","2010","2011","2012","2013","2014","2015","2016","2017",
      "2018","2019","2020","2021","2022","2023","2024"
    ], "as": ["Year","Value"] },
    { "calculate": "toNumber(datum.Value)", "as": "ValueNum" },
    { "calculate": "toNumber(datum.Year)", "as": "YearNum" },
    { "calculate": "datum.Year == '2024' ? toNumber(datum.Value) : 0", "as": "Value2024" },
    { "joinaggregate": [{ "op": "max", "field": "Value2024", "as": "countryMax2024" }], "groupby": ["Country"] },
    { "window": [{ "op": "row_number", "as": "rank2024" }], "sort": [{ "field": "countryMax2024", "order": "descending" }] },
    { "filter": "datum.rank2024 <= 10" }
  ],
  "mark": { "type": "rect" },
  "encoding": {
    "x": { "field": "Year", "type": "ordinal", "title": "Year" },
    "y": {
      "field": "Country",
      "type": "nominal",
      "title": "Country",
      "sort": { "op": "max", "field": "ValueNum", "order": "descending" }
    },
    "color": {
      "field": "ValueNum",
      "type": "quantitative",
      "title": "Arrivals",
      "scale": { "scheme": "greens" }
    },
    "tooltip": [
      { "field": "Country", "type": "nominal" },
      { "field": "Year", "type": "ordinal" },
      { "field": "ValueNum", "type": "quantitative", "title": "Arrivals", "format": "," }
    ]
  }
}
