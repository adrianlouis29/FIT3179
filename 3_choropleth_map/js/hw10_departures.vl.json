{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "description": "International departures by country over years - interactive chart for FIT3179 Week 10",
  "width": 700,
  "height": 420,
  "data": { "url": "data/Departure data.csv" },
  "transform": [
    { "calculate": "datum['']", "as": "Country" },
    {
      "fold": [
        "1991","1992","1993","1994","1995","1996","1997","1998","1999",
        "2000","2001","2002`","2003","2004","2005","2006","2007","2008",
        "2009","2010","2011","2012","2013","2014","2015","2016","2017",
        "2018","2019","2020","2021","2022","2023","2024"
      ],
      "as": ["Year","Departures"]
    },
    { "calculate": "toNumber(datum.Departures)", "as": "DeparturesNum" },
    { "calculate": "toNumber(datum.Year)", "as": "YearNum" }
  ],
  "params": [
    {
      "name": "selectedYear",
      "value": 2024,
      "bind": { "input": "range", "min": 1991, "max": 2024, "step": 1 }
    }
  ],
  "layer": [
    {
      "mark": { "type": "line", "point": false },
      "encoding": {
        "x": { "field": "YearNum", "type": "quantitative", "title": "Year" },
        "y": {
          "field": "DeparturesNum",
          "type": "quantitative",
          "title": "Departures",
          "axis": { "format": "," }
        },
        "color": {
          "field": "Country",
          "type": "nominal",
          "legend": { "orient": "right", "columns": 1 }
        },
        "opacity": {
          "condition": { "test": "datum.YearNum <= selectedYear", "value": 1 },
          "value": 0.15
        },
        "tooltip": [
          { "field": "Country", "type": "nominal" },
          { "field": "YearNum", "type": "quantitative", "title": "Year" },
          {
            "field": "DeparturesNum",
            "type": "quantitative",
            "title": "Departures",
            "format": ","
          }
        ]
      }
    },
    {
      "transform": [{ "filter": "datum.YearNum == selectedYear" }],
      "mark": { "type": "point", "filled": true, "size": 80 },
      "encoding": {
        "x": { "field": "YearNum", "type": "quantitative" },
        "y": { "field": "DeparturesNum", "type": "quantitative" },
        "color": { "field": "Country", "type": "nominal", "legend": null },
        "tooltip": [
          { "field": "Country", "type": "nominal" },
          {
            "field": "DeparturesNum",
            "type": "quantitative",
            "format": ","
          }
        ]
      }
    },
    {
      "transform": [
        {
          "aggregate": [
            { "op": "max", "field": "DeparturesNum", "as": "countryMax" }
          ],
          "groupby": ["Country"]
        },
        { "filter": "datum.DeparturesNum == datum.countryMax" }
      ],
      "mark": { "type": "text", "dy": -8, "fontWeight": "bold", "fontSize": 11 },
      "encoding": {
        "x": { "field": "YearNum", "type": "quantitative" },
        "y": { "field": "DeparturesNum", "type": "quantitative" },
        "text": {
          "field": "DeparturesNum",
          "type": "quantitative",
          "format": ","
        },
        "color": { "field": "Country", "type": "nominal" },
        "opacity": { "value": 0.95 }
      }
    }
  ],
  "title": {
    "text": "International Departures - trend by country (1991-2024)",
    "subtitle": "Use the year slider to focus. Hover for tooltips. Top value per country is labelled."
  }
}
