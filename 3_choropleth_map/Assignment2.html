<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>FIT3179 Assignment 2 - Visualisations</title>
  <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
  <link rel="stylesheet" href="css/styles.css" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Poppins:wght@600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/hw10.css" />
  <style>
    .hero { text-align: center; max-width: 1000px; margin: 0 auto 24px; }
    :root {
      --border: #e5e7eb;
      --text: #0f172a;
      --muted: #6b7280;
      --accent: #1f7a8c;
      --row-bg: #ffffff;
    }
    body { color: var(--text); font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; }
    .hero { text-align: center; max-width: 1000px; margin: 0 auto 24px; padding-bottom: 12px; border-bottom: 2px solid var(--border); }
    .page-title { margin: 16px 0 8px; font-family: Poppins, Inter, sans-serif; font-weight: 700; letter-spacing: 0.3px; }
    .blurb { margin: 0 auto; max-width: 900px; line-height: 1.55; color: var(--muted); }
    .map-section { margin: 24px auto 32px; max-width: 1100px; text-align: center; }
    .map-wrapper { display: flex; justify-content: center; }
    .map-viz { width: min(100%, 1050px); }
    .section-title { margin: 8px 0 12px; text-align: center; }
    .section-title { margin: 8px 0 12px; text-align: center; font-family: Poppins, Inter, sans-serif; font-weight: 600; color: var(--accent); }
    .row { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; align-items: start; max-width: 1200px; margin: 24px auto; padding: 0 12px; }
    .row { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; align-items: start; max-width: 1200px; margin: 28px auto; padding: 16px 16px; border: 1px solid var(--border); border-radius: 10px; background: var(--row-bg); box-shadow: 0 6px 20px rgba(2,6,23,0.04); }
  .row .col.viz .viz-area { width: 100%; min-height: 380px; }
    .row .col.viz .viz-area { width: 100%; min-height: 380px; }
    .row h3 { margin: 0 0 6px; font-family: Poppins, Inter, sans-serif; font-weight: 600; }
    .row p { margin: 0; color: var(--muted); }

    /* Alternating layout */
    .alt-left .col.text { order: 1; }
    .alt-left .col.viz { order: 2; }
    .alt-right .col.viz { order: 1; }
    .alt-right .col.text { order: 2; }

  /* For the Arrivals by State Over Time row: stack text under the chart */
  .row.states-area { grid-template-columns: 1fr; }
  .row.states-area .col.text { margin-top: 10px; }

    @media (max-width: 900px) {
      .row { grid-template-columns: 1fr; }
      .alt-left .col.text, .alt-left .col.viz,
      .alt-right .col.text, .alt-right .col.viz { order: unset; }
    }
  </style>
</head>
<body>
  <div class="container">
    <header class="hero">
      <h1 class="page-title">Australian Tourism</h1>
      <p class="blurb">Tourism is a vital pillar of Australia's economy, supporting local businesses, jobs, and cultural exchange. Over time, travel patterns have evolved with economic cycles, global events, and shifting preferences. The visuals below explore how tourism to and from Australia has changed across destinations and states.</p>
    </header>

    <!-- Centered map -->
    <section class="map-section">
      <div class="map-wrapper">
        <div id="choropleth_map" class="viz-area map-viz"></div>
      </div>
    </section>

    <!-- Alternating two-column rows: graph + narrative -->
    <section class="row alt-left">
      <div class="col text">
        <h3>International Departures (1991-2024)</h3>
        <p>Australians' outbound travel has generally trended upward, punctuated by clear downturns around major disruptions. Use the slider to focus on the most-travelled destinations in 2024 and see how they compare. Notice how regional proximity and airline capacity shape the top of the list in most years.</p>
        <div class="controls inline">Countries shown: <input id="departuresTopN" type="range" min="4" max="30" value="10" /></div>
      </div>
      <div class="col viz">
        <div id="departures_chart" class="viz-area"></div>
      </div>
    </section>

    <section class="row alt-right">
      <div class="col viz">
        <div id="heatmap_card" class="viz-area"></div>
        <div class="controls inline">
          Metric:
          <select id="heatmapMetric">
            <option value="departures">Departures</option>
            <option value="arrivals">Arrivals</option>
          </select>
        </div>
      </div>
      <div class="col text">
        <h3>Arrivals vs Departures by Country</h3>
        <p>This heatmap highlights hotspots over time. Switch between arrivals and departures to see how international connections have strengthened or cooled in different periods. Peaks and troughs often align with currency shifts, seasonal demand, and policy changes.</p>
      </div>
    </section>

    <section class="row alt-left">
      <div class="col text">
        <h3>Top Destinations in 2024</h3>
        <p>In 2024, a handful of destinations account for a large share of trips. Adjust the slider to change how many countries are shown and compare their relative volumes. Toggle between arrivals and departures to see how the top list differs for inbound and outbound travel.</p>
        <div class="controls inline">Countries shown: <input id="barTopN" type="range" min="4" max="30" value="10" /></div>
      </div>
      <div class="col viz">
        <div id="bar_card" class="viz-area"></div>
        <div class="controls inline">Metric:
          <select id="barMetric">
            <option value="departures">Departures</option>
            <option value="arrivals">Arrivals</option>
          </select>
        </div>
      </div>
    </section>

    <section class="row alt-right states-area">
      <div class="col viz">
        <div id="states_area" class="viz-area"></div>
      </div>
      <div class="col text">
        <h3>Arrivals by State Over Time</h3>
        <p>Tourism is distributed unevenly across states and territories. Use the brush below the chart to focus on particular periods, and click a state to highlight it. Watch how larger states lead during international booms while others gain share during domestic rebounds.</p>
      </div>
    </section>

    <section class="row alt-left">
      <div class="col text">
        <h3>State Rankings by Arrivals</h3>
        <p>Rankings shift as states gain or lose share across the years. The bump chart shows these movements at a glance - lower ranks indicate higher arrivals. Crossing lines highlight key turning points where states swap positions.</p>
      </div>
      <div class="col viz">
        <div id="states_bump" class="viz-area"></div>
      </div>
    </section>

    <section class="row alt-right">
      <div class="col viz">
        <div id="states_pie" class="viz-area"></div>
      </div>
      <div class="col text">
        <h3>Share of Arrivals by State</h3>
        <p>Select a year to see how the total arrivals are divided across states. Notice how the distribution shifts around major events and recovery periods. The share mix provides context for the rankings and trends above.</p>
      </div>
    </section>

    <footer>
      <p>Data source: <a href="https://www.abs.gov.au/statistics">Australian Bureau of Statistics</a></p>
    </footer>
  </div>

  <script>
    // embed existing choropleth map (file in repo) - let embed size to container
  vegaEmbed('#choropleth_map', 'js/choropleth_map_hw9.vg.json', { actions: false, renderer: 'canvas' })
      .catch(console.error);

    // embed new departures vega-lite spec (size is controlled by CSS container)
    let departuresView = null;
    async function embedDepartures() {
      try {
        const res = await vegaEmbed('#departures_chart', 'js/hw10_departures.vl.json', { renderer: 'canvas', actions: false });
        departuresView = res.view;
        // wire departures-specific topN slider to this view (independent)
        const depTop = document.getElementById('departuresTopN');
        if (depTop) {
          depTop.addEventListener('input', async () => {
            const n = Number(depTop.value);
            try { await departuresView.signal('topN', n).runAsync(); }
            catch (e) { console.error('Failed to update departures topN', e); }
          });
          // set initial topN for departures
          await departuresView.signal('topN', Number(depTop.value)).runAsync();
        }
      } catch (err) {
        console.error('embedDepartures error', err);
      }
    }
    embedDepartures();

    // heatmap embed: robust binding with null checks and support for both change/input
    function embedHeatmap() {
      const sel = document.getElementById('heatmapMetric');
      const mode = sel && sel.value === 'arrivals' ? 'arrivals' : 'departures';
      const specPath = mode === 'arrivals' ? 'js/arrivals_heatmap.vl.json' : 'js/departures_heatmap.vl.json';
      vegaEmbed('#heatmap_card', specPath, { actions: false, renderer: 'canvas' }).catch(console.error);
    }
    document.addEventListener('DOMContentLoaded', () => {
      const sel = document.getElementById('heatmapMetric');
      if (sel) {
        sel.addEventListener('change', embedHeatmap);
        sel.addEventListener('input', embedHeatmap);
      }
      embedHeatmap();
    });
    // embed top-N bar chart (switches between departures/arrivals specs)
    let currentBarView = null;
    async function embedBar() {
      const metricSel = document.getElementById('barMetric');
      const metric = metricSel && metricSel.value === 'arrivals' ? 'arrivals' : 'departures';
      const specPath = metric === 'arrivals' ? 'js/top_arrivals_bar.vl.json' : 'js/top_departures_bar.vl.json';
      try {
        // remove previous view if present
        if (currentBarView && currentBarView.finalize) currentBarView.finalize();
        const embedResult = await vegaEmbed('#bar_card', specPath, { actions: false, renderer: 'canvas' });
        currentBarView = embedResult.view;
        // wire topN slider to spec signal
        const topSlider = document.getElementById('barTopN');
        if (topSlider) {
          topSlider.addEventListener('input', async () => {
            const n = Number(topSlider.value);
            try { await currentBarView.signal('topN', n).runAsync(); }
            catch (e) { console.error('Failed to update topN', e); }
          });
          // set initial value
          await currentBarView.signal('topN', Number(topSlider.value)).runAsync();
        }
      } catch (err) {
        console.error('embedBar error', err);
      }
    }
    // wire metric select to re-embed
    (function setupBarMetric() {
      const m = document.getElementById('barMetric');
      if (!m) return;
      m.addEventListener('change', embedBar);
      m.addEventListener('input', embedBar);
    })();
  // initial embed after DOM ready
  document.addEventListener('DOMContentLoaded', () => embedBar());

    // sliders are independent: barTopN is wired in embedBar(), departuresTopN is wired in embedDepartures()

    // embed states stacked area
    vegaEmbed('#states_area', 'js/states_stacked_area.vl.json', { actions: false, renderer: 'canvas' })
      .catch(console.error);

    // embed states bump chart
    vegaEmbed('#states_bump', 'js/states_bump_chart.vl.json', { actions: false, renderer: 'canvas' })
      .catch(console.error);

    // embed states share pie (with year slider)
    vegaEmbed('#states_pie', 'js/states_share_pie.vl.json', { actions: false, renderer: 'canvas' })
      .catch(console.error);
  </script>
</body>
</html>
